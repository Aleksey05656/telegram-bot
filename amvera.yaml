# @file: amvera.yaml
# @description: Deployment configuration for Amvera platform
# @dependencies: requirements.txt, scripts/worker.py, scripts/tg_bot.py, app/api.py
# @created: 2025-10-27
meta:
  environment: python
  toolchain:
    name: pip
    version: 3.10

build:
  requirementsPath: requirements.txt

run:
  command: >
    bash -lc '
    case "$ROLE" in
      api)
        python -m app.migrations.up || true;
        uvicorn app.api:app --host 0.0.0.0 --port ${PORT:-80}
        ;;
      worker)
        python -m scripts.worker
        ;;
      tgbot)
        python -m scripts.tg_bot
        ;;
      *)
        echo "Unknown ROLE=$ROLE. Use api|worker|tgbot" && exit 1
        ;;
    esac'
  containerPort: 80
  persistenceMount: /data
