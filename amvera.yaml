# @file: amvera.yaml
# @description: Deployment configuration for Amvera platform
# @dependencies: requirements.txt, scripts/worker.py, scripts/tg_bot.py, app/api.py
# @created: 2025-10-27
meta:
  environment: python
  toolchain:
    name: pip
    version: 3.11

build:
  requirementsPath: requirements.txt

run:
  containerPort: 80
  persistenceMount: /data
  release:
    preflight:
      env:
        ROLE: preflight
      cmd:
        - python
        - -m
        - scripts.role_dispatch
    migrate:
      env:
        ROLE: migrate
      cmd:
        - python
        - -m
        - scripts.role_dispatch
  processes:
    api:
      env:
        API_ENABLED: "true"
        PYTHONUNBUFFERED: "1"
        LOG_LEVEL: INFO
        PORT: "80"
      cmd:
        - python
        - -m
        - scripts.api_server
    bot:
      env:
        ROLE: bot
        PYTHONUNBUFFERED: "1"
        LOG_LEVEL: INFO
      cmd:
        - python
        - -m
        - scripts.role_dispatch
